# 产品需求文档 (PRD) - UVC 相机本地管理系统

## 1. 项目概述
本项目旨在开发一款基于 macOS 平台的桌面应用程序，用于连接和管理 UVC (USB Video Class) 协议的摄像头。应用完全**本地运行，无需联网**，支持实时视频流预览、图像采集（拍照）、以及基于特定 ID 的本地数据存储与管理。

## 2. 核心目标
- **纯本地化**：所有数据（图像、数据库记录）均存储在用户本地设备，不依赖云端服务。
- **硬件兼容**：支持标准 UVC 协议摄像头（如 USB 显微镜、工业相机、普通 Webcam）。
- **数据关联**：拍摄的图像需与特定的 ID（如工单号、用户ID、产品序列号）关联存储。

## 3. 功能需求

### 3.1 摄像头管理
- **设备识别**：自动检测当前连接的所有 UVC 摄像头设备。
- **设备切换**：用户可在下拉列表中选择要使用的摄像头。
- **视频预览**：
    - 实时显示摄像头画面。
    - 支持高帧率预览（取决于硬件能力）。
    - 画面比例自适应。

### 3.2 图像采集
- **拍照功能**：提供明显的拍照按钮或快捷键。
- **ID 录入**：
    - 在拍照前或拍照后，允许用户输入/扫描一个唯一 ID（Target ID）。
    - 支持手动输入文本。
- **存储逻辑**：
    - 图片文件保存至本地磁盘（如 `~/Documents/UVCCameraApp/Images/`）。
    - 文件命名规范：`{ID}_{TIMESTAMP}.jpg`。

### 3.3 本地数据管理 (SQLite)
- **数据库设计**：
    - 使用本地 SQLite 数据库。
    - 表结构包含：`id` (主键), `target_id` (关联ID), `image_path` (本地路径), `created_at` (拍摄时间), `metadata` (备注/扩展字段)。
- **历史记录**：
    - 显示最近拍摄的记录列表。
    - 支持按 `Target ID` 搜索/筛选历史图片。
    - 支持删除记录（同步删除本地文件）。

### 3.4 系统设置
- **存储路径设置**：允许用户更改图片默认保存位置。
- **分辨率设置**：如果摄像头支持多种分辨率，允许用户切换。

## 4. 非功能需求 (NFR)
- **离线可用性**：应用启动、运行、存储全过程不需要网络连接。
- **性能**：视频预览延迟需低于 200ms；拍照保存过程不卡顿。
- **隐私安全**：应用不收集任何用户数据上传服务器。
- **兼容性**：支持 macOS 12.0 及以上版本。

## 5. 技术栈规划
- **框架**：Flutter (macOS Desktop)
- **摄像头插件**：`camera_macos` 或官方 `camera` 插件 (需验证 UVC 兼容性)
- **数据库**：`sqflite_common_ffi` (SQLite for Desktop)
- **文件系统**：`path_provider`
- **状态管理**：Provider / Riverpod (待定)

## 6. 界面流程 (草图)
1. **主界面**：左右分栏布局。
    - **左侧 (70%)**：巨大的摄像头预览窗口 + 底部控制栏（设备选择、拍照按钮）。
    - **右侧 (30%)**：
        - 顶部：ID 输入框 (TextField)。
        - 中部：当前 ID 已拍图片缩略图列表。
        - 底部：最近历史记录列表。

## 7. 待确认事项
- 是否需要支持视频录制？(目前仅提及拍照) -> *当前版本仅拍照*
- 是否需要简单的图片编辑功能（如标注、裁剪）？ -> *暂不包含，后续迭代*
- 是否需要导出数据（如导出 Excel 记录）？ -> *暂不包含*

---
**版本**: v1.0
**状态**: 草稿讨论中
