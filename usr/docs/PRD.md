# 产品需求文档 (PRD) - UVC相机采集与管理系统

## 1. 项目概述
**项目名称**: UVC Camera Manager (macOS)
**目标平台**: macOS (Desktop)
**核心功能**: 识别并连接UVC摄像头，实时预览视频流，支持关联ID进行拍照，并将图像数据及元数据存储至本地数据库。

## 2. 用户流程 (User Flow)
1. **启动应用**: 用户打开App。
2. **设备选择**: 系统自动检测可用摄像头，用户在下拉列表中选择目标UVC设备。
3. **预览阶段**: 界面显示摄像头实时画面。
4. **数据录入**: 用户输入或扫描一个“ID”（如工单号、用户ID、产品SN码）。
5. **采集图像**: 用户点击“拍照”按钮。
6. **存储处理**: 系统将图片保存到本地磁盘，并将 `ID` + `图片路径` + `时间戳` 写入SQLite数据库。
7. **历史查看**: 用户可在侧边栏或历史页查看已拍摄的记录。

## 3. 功能模块详解

### 3.1 摄像头管理 (Camera Module)
*   **设备枚举**: 获取当前连接的所有视频输入设备列表。
*   **视频预览**: 高帧率显示所选摄像头的实时画面。
*   **分辨率设置**: (可选) 支持切换摄像头的分辨率 (如 1080p, 720p)。
*   **UVC协议支持**: 基于标准USB Video Class协议，支持即插即用。

### 3.2 图像采集 (Capture Module)
*   **拍照**: 截取当前视频帧。
*   **ID关联**: 拍照前必须存在当前活跃的ID（支持手动输入）。
*   **格式**: 保存为 JPG 或 PNG 格式。

### 3.3 本地存储 (Storage & Database)
*   **文件存储**: 图片文件存储在 `ApplicationSupport` 或用户指定的文档目录下，按日期或ID分文件夹归档。
*   **数据库**: 使用 SQLite。
    *   **表结构 (Captures)**:
        *   `id` (Primary Key, Auto Increment)
        *   `target_id` (String, 用户输入的ID)
        *   `file_path` (String, 图片本地绝对路径)
        *   `created_at` (DateTime, 拍摄时间)
        *   `meta_data` (String, 预留字段，如分辨率信息)

### 3.4 历史记录与管理 (History UI)
*   **列表展示**: 按时间倒序展示拍摄记录（缩略图 + ID + 时间）。
*   **详情查看**: 点击缩略图查看大图。
*   **删除功能**: 支持删除记录及对应的本地文件。

## 4. 技术栈 (Technical Stack)
*   **UI框架**: Flutter (macOS Desktop)
*   **摄像头插件**: `camera` (官方插件，支持macOS) 或 `camera_macos`
*   **数据库**: `sqlite3` + `drift` 或 `sqflite_common_ffi`
*   **文件系统**: `path_provider`

## 5. 界面布局草图 (Layout Draft)
```
+-------------------------------------------------------+
|  [设备选择下拉框]  [分辨率设置]           [历史记录]    |
+---------------------------------------+---------------+
|                                       | ID: A001      |
|                                       | [图片]        |
|                                       | 10:00:01      |
|           视频预览区域                 |---------------|
|           (Live Stream)               | ID: B002      |
|                                       | [图片]        |
|                                       | 09:45:20      |
|                                       |               |
+---------------------------------------+               |
| 输入ID: [_____________]  [ 拍照按钮 ] |               |
+---------------------------------------+---------------+
```

## 6. 待确认问题
1. 是否需要支持同时连接多个摄像头？
2. 图片是否需要上传到云端，还是纯本地？
3. 是否需要对图片进行简单的处理（如裁剪、旋转）？
